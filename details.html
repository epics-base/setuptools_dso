
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Troubleshooting &#8212; setuptools_dso  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Release Notes" href="releasenotes.html" />
    <link rel="prev" title="Probing Toolchain" href="probe.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">¶</a></h1>
<p>Extra prints during the build process may be enabled by passing <code class="docutils literal notranslate"><span class="pre">-v</span></code>
to <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> before the command.  eg.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">v</span> <span class="n">bdist_wheel</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="k">global</span><span class="o">-</span><span class="n">option</span> <span class="o">-</span><span class="n">v</span> <span class="o">.</span>
</pre></div>
</div>
</section>
<section id="mechanics">
<h1>Mechanics<a class="headerlink" href="#mechanics" title="Permalink to this heading">¶</a></h1>
<p>Libraries build with setuptools-dso will typically be linked, directly or indirectly, to python extension modules.
Such libraries should be loaded implicitly when the extension module is imported by the python runtime.
For this to work the OS runtime loader must be able to find these libraries.
This is complicated by OS differences, and a desire to support virtualenv and similar.</p>
<p>Supporting virtualenv prevents the use of absolute build time paths.</p>
<p>The resolutions to this complication differ for each OS depending on the
capabilities of the executable format used.</p>
<section id="elf-linux-nix-bsd">
<h2>ELF (Linux, *NIX, *BSD)<a class="headerlink" href="#elf-linux-nix-bsd" title="Permalink to this heading">¶</a></h2>
<p>For ELF (Executable and Linking Format) targets the RPATH mechanism is used with the magic $ORIGIN/ prefix.</p>
<p>Take as an example the following installed module tree:</p>
<ul class="simple">
<li><p>modulea/</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>__init__.py</p></li>
<li><p>_ext.so</p></li>
<li><p>lib/</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>libsup.so</p></li>
<li><p>libsup.so.0</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p>The supporting library is then linked with a library name of <code class="docutils literal notranslate"><span class="pre">libsup.so.0</span></code>
(eg. <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">-o</span> <span class="pre">libsup.so.0</span> <span class="pre">-shared</span> <span class="pre">-Wl,-soname,libsup.so.0</span> <span class="pre">...</span></code>)</p>
<p>When linking a dependent library or extension module <code class="docutils literal notranslate"><span class="pre">-Wl,-rpath,'$ORIGIN/lib'</span></code>
is given since the relative path from <code class="docutils literal notranslate"><span class="pre">_ext.so</span></code> to <code class="docutils literal notranslate"><span class="pre">libsup.so.0</span></code> is <code class="docutils literal notranslate"><span class="pre">./lib</span></code>.</p>
<p>Note that on Linux runtime linking is really a function of the libc (eg. glibc).</p>
</section>
<section id="mach-o-osx">
<h2>Mach-O (OSX)<a class="headerlink" href="#mach-o-osx" title="Permalink to this heading">¶</a></h2>
<p>Historically Mach-O did not support anything like RPATH.
However, it now does (cf. ‘man dyld’)</p>
<p>The equivalence with GCC+ELF is for <code class="docutils literal notranslate"><span class="pre">-Wl,-soname,libsup.so.0</span></code> to become <code class="docutils literal notranslate"><span class="pre">-install\_name</span> <span class="pre">&#64;rpath/libsup.0.dylib</span></code>.
Then <code class="docutils literal notranslate"><span class="pre">-Wl,-rpath,'$ORIGIN/lib'</span></code> becomes <code class="docutils literal notranslate"><span class="pre">-Wl,-rpath,&#64;loader_path/lib</span></code>.</p>
</section>
<section id="pe-windows">
<h2>PE (Windows)<a class="headerlink" href="#pe-windows" title="Permalink to this heading">¶</a></h2>
<p>There is no equivalent for RPATH.
It is necessary to adjust the loader search path to include the directory
containing the support library dll explicitly from python code prior to loading the extension.
(eg. from an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>)</p>
<p>With earlier versions of Windows it is sufficient to adjust <code class="docutils literal notranslate"><span class="pre">%PATH%</span></code>.
Recent versions require use of the <code class="docutils literal notranslate"><span class="pre">AddDllDirectory()</span></code> API call.
Python wraps this as <code class="docutils literal notranslate"><span class="pre">os.add_dll_directory()</span></code>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">setuptools_dso</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mdavidsaver&repo=setuptools_dso&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="usage.html">Working with packages using setuptools_dso</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#applying-to-your-package">Applying to your package</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#runtime">Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="probe.html">Probing Toolchain</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="#mechanics">Mechanics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#elf-linux-nix-bsd">ELF (Linux, *NIX, *BSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mach-o-osx">Mach-O (OSX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pe-windows">PE (Windows)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="releasenotes.html">Release Notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="probe.html" title="previous chapter">Probing Toolchain</a></li>
      <li>Next: <a href="releasenotes.html" title="next chapter">Release Notes</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Michael Davidsaver.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/details.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/mdavidsaver/setuptools_dso" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="_static/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>